# BlackBoard/helm/values.yaml
# Darwin Blackboard (Brain) Helm values

# =============================================================================
# Brain Container Configuration
# =============================================================================

image:
  repository: ghcr.io/the-darwin-project/blackboard
  tag: "e32b6de" # Updated by CI to commit SHA
  pullPolicy: IfNotPresent
replicaCount: 1
# =============================================================================
# Redis Sidecar Configuration (registry.redhat.io/rhel9/redis-7)
# =============================================================================
redis:
  enabled: true
  image:
    repository: registry.redhat.io/rhel9/redis-7
    tag: "latest"
  password: "" # Override via secret or ArgoCD app parameters
  persistence:
    enabled: true # Enables RDB snapshots to PVC -- survives pod restarts
    storageClassName: "" # Override via ArgoCD app parameters
    size: 8Gi
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 6Gi
      cpu: 6
# =============================================================================
# Qdrant Vector DB Sidecar (Deep Memory)
# =============================================================================
qdrant:
  enabled: true
  image:
    repository: ghcr.io/qdrant/qdrant/qdrant
    tag: "v1.16.3-unprivileged" # Non-root image for OpenShift SCC
  persistence:
    enabled: true
    storageClassName: "" # Override via ArgoCD app parameters (use block storage, NOT CephFS -- Qdrant WAL needs flock)
    accessMode: ReadWriteOnce
    size: 10Gi
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 8Gi
      cpu: "2"
  port: 6333 # HTTP API
  grpcPort: 6334 # gRPC API
# =============================================================================
# Agent Sidecars Configuration (same base image, per-agent CLI type and rules)
# =============================================================================
sidecars:
  architect:
    enabled: true
    port: 9091
    cliType: "claude" # "gemini" or "claude"
    gitUserName: "Darwin Architect"
    gitUserEmail: "darwin-architect@darwin-project.io"
    modelName: "claude-opus-4-6" # Claude Opus 4.6 via Vertex AI (deep planning, code analysis)
    permissionMode: "" # No hard restriction -- soft rules via architect.md + skills
  sysadmin:
    enabled: true
    port: 9092
    cliType: "gemini" # "gemini" or "claude"
    interactive: true # Gemini PTY mode (multi-turn sessions like Claude --resume)
    gitUserName: "Darwin SysAdmin"
    gitUserEmail: "darwin-sysadmin@darwin-project.io"
    modelName: "gemini-3-flash-preview" # Gemini 3 Flash (fast investigation, low latency)
    permissionMode: "" # No permission mode for gemini
  developer:
    enabled: true
    port: 9093
    cliType: "claude" # Claude Code for code generation
    gitUserName: "Darwin Developer"
    gitUserEmail: "darwin-developer@darwin-project.io"
    modelName: "claude-opus-4-6" # Claude Opus 4.6 via Vertex AI
    permissionMode: "bypassPermissions" # Skip permission prompts for autonomous code changes
  qe:
    enabled: true
    port: 9094
    cliType: "gemini"
    interactive: true # Gemini PTY mode (multi-turn sessions like Claude --resume)
    gitUserName: "Darwin QE"
    gitUserEmail: "darwin-qe@darwin-project.io"
    modelName: "gemini-3-pro-preview" # Pro for thorough verification
    permissionMode: "" # No permission mode for gemini
  # Shared image for all sidecars
  image:
    repository: ghcr.io/the-darwin-project/gemini-sidecar
    tag: "43947b8" # Updated by CI to commit SHA
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 6Gi
      cpu: "6"
  # Shared persistent storage for agent working directories (git clones)
  persistence:
    enabled: true
    storageClassName: "" # Override via ArgoCD app parameters
    size: 5Gi
    accessModes:
      - ReadWriteMany
# =============================================================================
# GCP / Vertex AI Configuration
# =============================================================================
gcp:
  project: "" # Required: GCP project ID (set via --set or override file)
  location: "global"
  provider: "gemini" # Brain LLM provider: "gemini" or "claude"
  models:
    pro: "gemini-3-pro-preview"
    flash: "gemini-3-flash-preview"
    claude: "claude-opus-4-6" # Claude model ID (used when provider=claude)
  # LLM sampling parameters (0.0-2.0 range, normalized per provider)
  temperature:
    brain: "0.8" # Brain orchestrator decisions
    aligner: "0.3" # Aligner metrics analysis (Flash)
  # Service account JSON secrets (pre-created K8s Secrets)
  # Brain SA -- for Brain orchestrator Vertex AI calls
  existingSecret: "" # e.g., "gcp-sa-key"
  # Agent SA -- separate SA for agent sidecars (avoids sharing 429 quota with Brain)
  agentExistingSecret: "" # e.g., "gcp-agent-key"
# =============================================================================
# Service Configuration
# =============================================================================
service:
  type: ClusterIP
  port: 8000
# =============================================================================
# Route Configuration (OpenShift)
# =============================================================================
route:
  enabled: true
  # host: darwin-brain.apps.example.com  # Leave empty for auto-generated
  annotations:
    haproxy.router.openshift.io/timeout: 300s
  tls:
    enabled: true
    termination: edge # edge, passthrough, or reencrypt
    insecureEdgeTerminationPolicy: Redirect # Allow, Redirect, or None
# =============================================================================
# Application Metadata
# =============================================================================
app:
  name: "darwin-brain"
  version: "1.0.0"
  debug: false
  # Agent dispatch settings (Brain-level, not sidecar-level)
  dryRun: false # Set to true for testing (no real changes)
  autoApprove: true # Enable closed-loop automation (values-only changes auto-approved)
  gitRepoPath: "/data/gitops"
# =============================================================================
# GitHub App Configuration (for GitOps authentication)
# =============================================================================
github:
  # Pre-created secret containing:
  # - app-id: GitHub App ID
  # - installation-id: GitHub App Installation ID
  # - <name>.pem: Private key file
  existingSecret: "" # e.g., "darwin-github-app"
  # Branch to use (for reference, sidecar defaults to main)
  branch: "main"
# =============================================================================
# GitLab Token Configuration (for GitLab GitOps authentication)
# =============================================================================
gitlab:
  enabled: false
  # Pre-created secret with keys: token, host
  # - token: GitLab Service Account / Group Access Token (PAT)
  #   Required scopes: api, read_repository, write_repository
  # - host: GitLab instance hostname (e.g., gitlab.example.com)
  existingSecret: "" # e.g., "darwin-gitlab-token"
# =============================================================================
# ArgoCD CLI Credentials (for agent ArgoCD API access)
# =============================================================================
argocd:
  enabled: false
  # Pre-created secret with keys: server, auth-token
  existingSecret: "" # e.g., "darwin-argocd-creds"
  # Server URL (e.g., argocd-server.argocd-ns.svc.cluster.local:443)
  server: ""
  # Set to true if using self-signed certs
  insecure: true
# =============================================================================
# Kargo CLI Credentials (for agent Kargo pipeline access)
# =============================================================================
kargo:
  enabled: false
  # Pre-created secret with keys: server, auth-token
  existingSecret: "" # e.g., "darwin-kargo-creds"
  # Server URL (e.g., kargo-api.kargo-ns.svc.cluster.local:443)
  server: ""
  insecure: true
# =============================================================================
# Resource Limits (Brain container -- singleton, handles event loop + LLM calls)
# =============================================================================
resources:
  requests:
    memory: 1Gi
    cpu: 400m
  limits:
    memory: 6Gi
    cpu: "6"
# =============================================================================
# Security Context (OpenShift compatible)
# =============================================================================
podSecurityContext:
  fsGroup: 1001
securityContext:
  runAsNonRoot: true
  # OpenShift assigns arbitrary UID from namespace range
  # Do NOT set runAsUser - let OpenShift assign it
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false # App needs /tmp
  capabilities:
    drop:
      - ALL
# =============================================================================
# Probes
# =============================================================================
livenessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 20
  periodSeconds: 30
  failureThreshold: 5
readinessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 15
  periodSeconds: 10
  failureThreshold: 5
# =============================================================================
# Kubernetes Observer Configuration
# =============================================================================
observer:
  enabled: true # Enable K8s metrics observer
  namespaces:
    - darwin
  interval: 30 # Poll interval in seconds
  labelSelector: "" # Optional: filter pods by label (e.g., "app=darwin-store")
# =============================================================================
# Aligner Anomaly Thresholds
# =============================================================================
aligner:
  thresholds:
    cpu: "80.0" # CPU % above which Flash analyzes the service
    memory: "85.0" # Memory % above which Flash analyzes the service
    errorRate: "5.0" # Error rate % above which Flash analyzes the service
# =============================================================================
# Slack Integration (Socket Mode, bidirectional event mirroring)
# =============================================================================
slack:
  enabled: false
  existingSecret: "" # e.g., "slack-credentials" (keys: bot-token, app-token)
  channels:
    infrastructure: "" # Channel ID for #darwin-infra (e.g., "C0XXXXXXX")
    mrFallback: "" # Channel ID for #cnv-ci-release (e.g., "C0YYYYYYY")
  userMapping:
    method: "email" # "email" (auto-lookup via Slack API) or "static"
# =============================================================================
# Node Selection (optional)
# =============================================================================
nodeSelector: {}
tolerations: []
affinity: {}
