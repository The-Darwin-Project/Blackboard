# BlackBoard/helm/values.yaml
# Darwin Blackboard (Brain) Helm values

# =============================================================================
# Brain Container Configuration
# =============================================================================

image:
  repository: ghcr.io/the-darwin-project/blackboard
  tag: "c9aaaa6" # Updated by CI to commit SHA
  pullPolicy: IfNotPresent
replicaCount: 1
# =============================================================================
# Redis Sidecar Configuration (registry.redhat.io/rhel9/redis-7)
# =============================================================================
redis:
  enabled: true
  image:
    repository: registry.redhat.io/rhel9/redis-7
    tag: "latest"
  password: "darwin-brain" # Override via secret in production
  persistence:
    enabled: true # Enables RDB snapshots to PVC -- survives pod restarts
    storageClassName: "ocs-storagecluster-cephfs"
    size: 8Gi
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 6Gi
      cpu: 6
# =============================================================================
# Qdrant Vector DB Sidecar (Deep Memory)
# =============================================================================
qdrant:
  enabled: true
  image:
    repository: ghcr.io/qdrant/qdrant/qdrant
    tag: "v1.16.3-unprivileged" # Non-root image for OpenShift SCC
  persistence:
    enabled: true
    storageClassName: "ocs-storagecluster-cephfs"
    size: 10Gi
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 8Gi
      cpu: "2"
  port: 6333 # HTTP API
  grpcPort: 6334 # gRPC API
# =============================================================================
# Agent Sidecars Configuration (same base image, per-agent CLI type and rules)
# =============================================================================
sidecars:
  architect:
    enabled: true
    port: 9091
    cliType: "gemini" # "gemini" or "claude"
    gitUserName: "Darwin Architect"
    gitUserEmail: "darwin-architect@darwin-project.io"
    modelName: "gemini-3-pro-preview" # Gemini 3 Pro (deep planning, code analysis)
  sysadmin:
    enabled: true
    port: 9092
    cliType: "gemini" # "gemini" or "claude"
    gitUserName: "Darwin SysAdmin"
    gitUserEmail: "darwin-sysadmin@darwin-project.io"
    modelName: "gemini-3-flash-preview" # Gemini 3 Flash (fast investigation, low latency)
  developer:
    enabled: true
    port: 9093
    cliType: "claude" # Claude Code for code generation
    gitUserName: "Darwin Developer"
    gitUserEmail: "darwin-developer@darwin-project.io"
    modelName: "claude-opus-4-6" # Claude Opus 4.6 via Vertex AI
  qe:
    enabled: true
    port: 9094
    cliType: "gemini"
    gitUserName: "Darwin QE"
    gitUserEmail: "darwin-qe@darwin-project.io"
    modelName: "gemini-3-pro-preview" # Pro for thorough verification
  # Shared image for all sidecars
  image:
    repository: ghcr.io/the-darwin-project/gemini-sidecar
    tag: "208aea4" # Updated by CI to commit SHA
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 6Gi
      cpu: "6"
  # Shared persistent storage for agent working directories (git clones)
  persistence:
    enabled: true
    storageClassName: "ocs-storagecluster-cephfs"
    size: 5Gi
    accessModes:
      - ReadWriteMany
# =============================================================================
# GCP / Vertex AI Configuration
# =============================================================================
gcp:
  project: "cnv-ai-insights" # Required: GCP project ID
  location: "global"
  provider: "gemini" # Brain LLM provider: "gemini" or "claude"
  models:
    pro: "gemini-3-pro-preview"
    flash: "gemini-3-flash-preview"
    claude: "claude-opus-4-6" # Claude model ID (used when provider=claude)
  # LLM sampling parameters (0.0-2.0 range, normalized per provider)
  temperature:
    brain: "0.8" # Brain orchestrator decisions
    aligner: "0.3" # Aligner metrics analysis (Flash)
  # Service account JSON can be mounted via secret
  # Set existingSecret to use a pre-created secret
  existingSecret: ""
# =============================================================================
# Service Configuration
# =============================================================================
service:
  type: ClusterIP
  port: 8000
# =============================================================================
# Route Configuration (OpenShift)
# =============================================================================
route:
  enabled: true
  # host: darwin-brain.apps.example.com  # Leave empty for auto-generated
  annotations:
    haproxy.router.openshift.io/timeout: 300s
  tls:
    enabled: true
    termination: edge # edge, passthrough, or reencrypt
    insecureEdgeTerminationPolicy: Redirect # Allow, Redirect, or None
# =============================================================================
# Application Metadata
# =============================================================================
app:
  name: "darwin-brain"
  version: "1.0.0"
  debug: false
  # Agent dispatch settings (Brain-level, not sidecar-level)
  dryRun: false # Set to true for testing (no real changes)
  autoApprove: true # Enable closed-loop automation (values-only changes auto-approved)
  gitRepoPath: "/data/gitops"
# =============================================================================
# GitHub App Configuration (for GitOps authentication)
# =============================================================================
github:
  # The GitHub App secret containing:
  # - app-id: GitHub App ID
  # - installation-id: GitHub App Installation ID
  # - darwin-ci.2026-02-04.private-key.pem: Private key file
  existingSecret: "darwin-github-app"
  # NOTE: repository field is no longer used - init container removed
  # GitOps repo is now determined dynamically from service telemetry
  # repository: "The-Darwin-Project/gitops"  # DEPRECATED
  # Branch to use (for reference, sidecar defaults to main)
  branch: "main"
# =============================================================================
# ArgoCD CLI Credentials (for agent ArgoCD API access)
# =============================================================================
argocd:
  enabled: true
  # Pre-created secret with keys: server, auth-token
  # If empty and enabled=true, a placeholder secret is rendered by the chart
  existingSecret: "darwin-argocd-creds"
  # Server URL (e.g., argocd-server.openshift-gitops.svc:443)
  server: "openshift-gitops-server.openshift-gitops.svc.cluster.local:8080"
  # Set to true if using self-signed certs
  insecure: true
# =============================================================================
# Kargo CLI Credentials (for agent Kargo pipeline access)
# =============================================================================
kargo:
  enabled: true
  # Pre-created secret with keys: server, auth-token
  # If empty and enabled=true, a placeholder secret is rendered by the chart
  existingSecret: "darwin-kargo-creds"
  # Server URL (e.g., kargo-api.kargo-system.svc:443)
  server: "kargo-api.kargo.svc.cluster.local:8080"
  insecure: true
# =============================================================================
# Resource Limits (Brain container -- singleton, handles event loop + LLM calls)
# =============================================================================
resources:
  requests:
    memory: 1Gi
    cpu: 400m
  limits:
    memory: 6Gi
    cpu: "6"
# =============================================================================
# Security Context (OpenShift compatible)
# =============================================================================
podSecurityContext:
  fsGroup: 1001
securityContext:
  runAsNonRoot: true
  # OpenShift assigns arbitrary UID from namespace range
  # Do NOT set runAsUser - let OpenShift assign it
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false # App needs /tmp
  capabilities:
    drop:
      - ALL
# =============================================================================
# Probes
# =============================================================================
livenessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 20
  periodSeconds: 30
  failureThreshold: 5
readinessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 15
  periodSeconds: 10
  failureThreshold: 5
# =============================================================================
# Kubernetes Observer Configuration
# =============================================================================
observer:
  enabled: true # Enable K8s metrics observer
  namespace: "darwin" # Namespace to watch for pods
  interval: 30 # Poll interval in seconds
  labelSelector: "" # Optional: filter pods by label (e.g., "app=darwin-store")
# =============================================================================
# Node Selection (optional)
# =============================================================================
nodeSelector: {}
tolerations: []
affinity: {}
