# BlackBoard/helm/values.yaml
# Darwin Blackboard (Brain) Helm values

# =============================================================================
# Brain Container Configuration
# =============================================================================

image:
  repository: ghcr.io/the-darwin-project/blackboard
  tag: "50915c7" # Updated by CI to commit SHA
  pullPolicy: IfNotPresent
replicaCount: 1
# =============================================================================
# Redis Sidecar Configuration (registry.redhat.io/rhel9/redis-7)
# =============================================================================
redis:
  enabled: true
  image:
    repository: registry.redhat.io/rhel9/redis-7
    tag: "latest"
  password: "darwin-brain" # Override via secret in production
  persistence:
    enabled: false # Set to true for production
    storageClassName: "" # e.g., ocs-storagecluster-cephfs
    size: 1Gi
  resources:
    requests:
      memory: 128Mi
      cpu: 50m
    limits:
      memory: 256Mi
      cpu: 200m
# =============================================================================
# Gemini CLI Sidecar Configuration
# =============================================================================
gemini:
  enabled: true
  image:
    repository: ghcr.io/the-darwin-project/gemini-sidecar
    tag: "ee92eec" # Updated by CI to commit SHA
  port: 9090
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m
# =============================================================================
# GCP / Vertex AI Configuration
# =============================================================================
gcp:
  project: "cnv-ai-insights" # Required: GCP project ID
  location: "global"
  models:
    pro: "gemini-3-pro-preview"
    flash: "gemini-3-flash-preview"
  # Service account JSON can be mounted via secret
  # Set existingSecret to use a pre-created secret
  existingSecret: ""
# =============================================================================
# Service Configuration
# =============================================================================
service:
  type: ClusterIP
  port: 8000
# =============================================================================
# Route Configuration (OpenShift)
# =============================================================================
route:
  enabled: true
  # host: darwin-brain.apps.example.com  # Leave empty for auto-generated
  annotations: {}
  tls:
    enabled: true
    termination: edge # edge, passthrough, or reencrypt
    insecureEdgeTerminationPolicy: Redirect # Allow, Redirect, or None
# =============================================================================
# Application Metadata
# =============================================================================
app:
  name: "darwin-brain"
  version: "1.0.0"
  debug: false
# =============================================================================
# SysAdmin Agent Configuration
# =============================================================================
sysadmin:
  dryRun: false # Set to true for testing (no real changes)
  autoApprove: true # Enable closed-loop automation (only values-only changes are auto-approved)
  gitRepoPath: "/data/gitops"
  persistence:
    enabled: false # Set true for production
    storageClassName: ""
    size: 1Gi
    accessModes:
      - ReadWriteMany
# =============================================================================
# GitHub App Configuration (for GitOps authentication)
# =============================================================================
github:
  # The GitHub App secret containing:
  # - app-id: GitHub App ID
  # - installation-id: GitHub App Installation ID
  # - darwin-ci.2026-02-04.private-key.pem: Private key file
  existingSecret: "darwin-github-app"
  # NOTE: repository field is no longer used - init container removed
  # GitOps repo is now determined dynamically from service telemetry
  # repository: "The-Darwin-Project/gitops"  # DEPRECATED
  # Branch to use (for reference, sidecar defaults to main)
  branch: "main"
# =============================================================================
# Resource Limits
# =============================================================================
resources:
  requests:
    memory: 256Mi
    cpu: 100m
  limits:
    memory: 512Mi
    cpu: 500m
# =============================================================================
# Security Context (OpenShift compatible)
# =============================================================================
podSecurityContext:
  fsGroup: 1001
securityContext:
  runAsNonRoot: true
  # OpenShift assigns arbitrary UID from namespace range
  # Do NOT set runAsUser - let OpenShift assign it
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false # App needs /tmp
  capabilities:
    drop:
      - ALL
# =============================================================================
# Probes
# =============================================================================
livenessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 10
  periodSeconds: 30
  failureThreshold: 3
readinessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 5
  periodSeconds: 10
  failureThreshold: 3
# =============================================================================
# Kubernetes Observer Configuration
# =============================================================================
observer:
  enabled: true # Enable K8s metrics observer
  namespace: "darwin" # Namespace to watch for pods
  interval: 30 # Poll interval in seconds
  labelSelector: "" # Optional: filter pods by label (e.g., "app=darwin-store")
# =============================================================================
# Node Selection (optional)
# =============================================================================
nodeSelector: {}
tolerations: []
affinity: {}
